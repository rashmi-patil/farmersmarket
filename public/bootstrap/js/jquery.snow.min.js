(function($){$.fn.extend({snowing:function(options){var defaults={minSize:10,maxSize:30,minOpacity:0.3,maxOpacity:1,intensity:5,meltingTime:5,flakeColors:["#FFFFFF","#EEEEEE","#DDDDDD"],flakeChars:['&#10052;','&#10053;','&#10054;']};var options=$.extend({},defaults,options);var position=$(this).offset();var minLeft=position.left,maxLeft=minLeft+$(this).width(),minTop=Math.floor(position.top-options.minSize/2),maxTop=Math.floor(position.top+$(this).height()-options.minSize/2),height=$(this).height();function createFlake(){var startLeftPosition=Math.floor(Math.random()*(maxLeft-minLeft+1))+minLeft,endPositionLeft=Math.floor(Math.random()*(maxLeft-minLeft+1))+minLeft,startFlakeSize=Math.floor(Math.random()*(options.maxSize-options.minSize+1))+options.minSize,endFlakeSize=Math.floor(Math.random()*(options.maxSize-options.minSize+1))+options.minSize,startOpacity=startFlakeSize/options.maxSize,endOpacity=endFlakeSize/options.maxSize,fallingDuration=height*30+10;nextFlakeAfter=Math.floor(Math.random()*10000/options.intensity);$('<div class="snow-flake" />').html(options.flakeChars[Math.floor(Math.random()*options.flakeChars.length)]).css({position:'absolute',top:minTop+'px',left:startLeftPosition,opacity:startOpacity,'font-size':startFlakeSize,color:options.flakeColors[Math.floor(Math.random()*options.flakeColors.length)]}).appendTo('body').animate({top:maxTop,left:endPositionLeft,fontSize:endFlakeSize,opacity:endOpacity},fallingDuration,'linear',function(){$(this).delay(options.meltingTime*2000).queue(function(next){$(this).fadeOut('slow',function(){$(this).remove()});next()})});setTimeout(createFlake,nextFlakeAfter)}createFlake()}})})(jQuery);